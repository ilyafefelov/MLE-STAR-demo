# Інтеграція MLE-STAR з абляційним аналізом

## Що це і навіщо

Цей проєкт складається з **трьох рівнів**:

### Рівень 1: MLE-STAR Agent (генерація пайплайна)
**Справжній MLE-STAR** - мультиагентна система на базі LLM, яка:
- Аналізує датасет
- Генерує оптимальний ML-пайплайн
- Використовує пошук + targeted refinement
- Автоматично підбирає гіперпараметри
- Створює ансамблі моделей

**Файли:**
- `src/mle_star_ablation/mle_star_wrapper.py` - обгортка для запуску агента
- `scripts/run_mle_star.py` - CLI для генерації пайплайна

### Рівень 2: Ablation Framework (аналіз компонентів)
**Наш інструмент** для абляційного аналізу:
- Бере згенерований MLE-STAR пайплайн
- По черзі вимикає компоненти (scaling, feature engineering, tuning, etc.)
- Запускає кожну конфігурацію багато разів
- Збирає метрики

**Файли:**
- `src/mle_star_ablation/mle_star_adapter.py` - адаптер для MLE-STAR пайплайнів
- `src/mle_star_ablation/pipelines.py` - управління конфігураціями
- `scripts/run_ablation.py` - запуск експериментів

### Рівень 3: Statistical Analysis (статистична оцінка)
**Статистичний аналіз** результатів:
- t-test, ANOVA для порівняння конфігурацій
- Поправка Бонферроні на множинні порівняння
- Обчислення розміру ефекту (Cohen's d)
- Візуалізація результатів

**Файли:**
- `src/mle_star_ablation/stats.py` - статистичні тести
- `src/mle_star_ablation/viz.py` - графіки
- `src/mle_star_ablation/metrics.py` - метрики

---

## Як це працює разом

```
┌─────────────────────────────────────────────────────────────┐
│  КРОК 1: Генерація пайплайна через MLE-STAR                 │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  python scripts/run_mle_star.py \                            │
│    --dataset data/my_data.csv \                              │
│    --task-type classification                                │
│                                                               │
│  → MLE-STAR аналізує дані                                    │
│  → Генерує оптимальний пайплайн                              │
│  → Зберігає код: mle_star_output/mle_star_pipeline.py       │
│                                                               │
│  Результат:                                                   │
│  ┌─────────────────────────────────────────┐                 │
│  │ Pipeline:                                │                 │
│  │  1. Imputer                              │                 │
│  │  2. StandardScaler                       │                 │
│  │  3. PolynomialFeatures                   │                 │
│  │  4. VotingClassifier(LR, RF, GB)         │                 │
│  └─────────────────────────────────────────┘                 │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│  КРОК 2: Абляційний аналіз                                   │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  python scripts/run_ablation.py \                            │
│    --mle-star-pipeline mle_star_output/mle_star_pipeline.py \│
│    --dataset data/my_data.csv \                              │
│    --n-runs 5                                                │
│                                                               │
│  → Створює варіанти пайплайна:                               │
│    1. Baseline (без жодних компонентів)                      │
│    2. + Scaling                                              │
│    3. + Scaling + Feature Engineering                        │
│    4. + Scaling + Feature Eng + Tuning                       │
│    5. Full pipeline (все ввімкнено)                          │
│                                                               │
│  → Кожну конфігурацію запускає 5 разів                       │
│  → Збирає accuracy, F1, ROC-AUC, тощо                        │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│  КРОК 3: Статистичний аналіз                                 │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  Автоматично:                                                │
│  → Paired t-test між конфігураціями                          │
│  → ANOVA для всіх груп                                       │
│  → Bonferroni correction                                     │
│  → Cohen's d (розмір ефекту)                                 │
│  → Графіки: barplot, boxplot, heatmap                        │
│                                                               │
│  Результат: results/statistical_report.txt                   │
└─────────────────────────────────────────────────────────────┘
```

---

## Важливі відмінності

| Аспект | MLE-STAR (агент) | Наш framework |
|--------|------------------|---------------|
| **Призначення** | Генерує ML-пайплайн | Аналізує пайплайн |
| **Технологія** | LLM + веб-пошук | scikit-learn + scipy |
| **Вхід** | Датасет + опис задачі | Готовий пайплайн |
| **Вихід** | Python код пайплайна | Метрики + статистика |
| **Час виконання** | 2-4 години | 5-30 хвилин |
| **Потрібен API key** | ✓ Так (Anthropic) | ✗ Ні |

---

## Для дипломної роботи

### Що писати в теоретичній частині

**MLE-STAR (Розділ 2):**
- Архітектура мультиагентної системи
- Роль LLM у генерації коду
- Процес пошуку та уточнення (search + refinement)
- Порівняння з іншими AutoML (Auto-sklearn, AutoGluon)

**Абляційний аналіз (Розділ 3):**
- Що таке ablation study
- Навіщо потрібен у ML
- Методологія вимикання компонентів
- Статистична оцінка значущості

### Що писати в практичній частині

**Експеримент (Розділ 4):**

1. **Генерація базового пайплайна:**
   ```
   Запустили MLE-STAR на датасеті [назва].
   Агент згенерував пайплайн з 4 компонентів:
   - Масштабування (StandardScaler)
   - Інженерія ознак (PolynomialFeatures)
   - Ансамбль моделей (VotingClassifier)
   - Тюнінг гіперпараметрів (GridSearchCV)
   
   Час генерації: 2.5 години
   Базова точність: 0.97
   ```

2. **Абляційний аналіз:**
   ```
   Створили 5 варіантів пайплайна з різними компонентами.
   Кожен варіант запустили 5 разів (різні random_seed).
   Зібрали метрики: accuracy, F1, ROC-AUC.
   ```

3. **Статистичний аналіз:**
   ```
   Провели парні t-тести між конфігураціями.
   Застосували поправку Бонферроні (α = 0.05/10 = 0.005).
   
   Результати:
   - Масштабування дає +3.2% accuracy (p < 0.001, Cohen's d = 0.85)
   - Інженерія ознак дає +1.5% (p < 0.01, Cohen's d = 0.42)
   - Ансамблювання дає +2.8% (p < 0.001, Cohen's d = 0.73)
   
   Висновок: Масштабування та ансамблювання мають найбільший вплив.
   ```

### Чесність дослідження

✅ **Правильно:**
> "Ми використали MLE-STAR для генерації базового пайплайна, після чого розробили інструментарій для абляційного аналізу його компонентів."

✅ **Правильно:**
> "На відміну від стандартних AutoML, які надають лише фінальну модель, наш підхід дозволяє кількісно оцінити внесок кожного компонента."

✅ **Правильно:**
> "Для статистичної оцінки ми використали парні t-тести з поправкою Бонферроні, що забезпечує надійність висновків."

❌ **Неправильно:**
> "MLE-STAR автоматично проводить абляційний аналіз" (не проводить)

❌ **Неправильно:**
> "Ми вдосконалили MLE-STAR" (ми аналізуємо його результати, а не змінюємо сам агент)

---

## Швидкий старт

### 1. Встановлення MLE-STAR

```bash
pip install mle-star
export ANTHROPIC_API_KEY="your_key_here"
```

### 2. Генерація пайплайна

```bash
python scripts/run_mle_star.py \
  --dataset data/breast_cancer.csv \
  --task-type classification \
  --search-iterations 1  # швидко для тесту
```

### 3. Абляційний аналіз

```bash
python scripts/run_ablation.py \
  --mle-star-pipeline mle_star_output/mle_star_pipeline.py \
  --dataset data/breast_cancer.csv \
  --n-runs 5
```

### 4. Результати

Дивіться в `results/`:
- `statistical_report.txt` - текстовий звіт
- `*.csv` - детальні метрики
- `*.png` - графіки

---

## Питання та відповіді

**Q: Чи можна запускати без MLE-STAR?**  
A: Так, для тестування. Скрипт `run_ablation.py` працює з будь-яким sklearn пайплайном. Але для диплома потрібен хоча б один запуск справжнього MLE-STAR.

**Q: Скільки часу займає повний експеримент?**  
A: MLE-STAR (генерація): 2-4 години. Абляційний аналіз: 10-30 хвилин (залежить від датасету).

**Q: Чи потрібен GPU?**  
A: MLE-STAR працює на CPU. Для абляції GPU бажаний, але не обов'язковий.

**Q: Скільки коштує API?**  
A: ~$5-10 на один повний експеримент (Claude API). Можна використати швидкий режим (--search-iterations 1) для економії.

---

**Автор:** Фефелов Ілля Олександрович  
**Диплом:** Абляційний аналіз та статистична оцінка важливості компонентів багатостадійного ML-конвеєра MLE-STAR  
**МАУП, 2025**
